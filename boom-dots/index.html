<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Boom Dots</title>
    <script src="phaser.min.js"></script>
</head>
<body>
<!-- 确定游戏元素,用到的功能
1. 绘制图像用bitmapData方法并用circle方法显示出圆形
2. 当鼠标按下时发射小球,需要鼠标按下事件
3. 游戏中的碰撞检测,需要物理引擎
4. 得分可以进行本地最高分存读 -->
<script>
    window.onload = function() {
        var GameState = function(game) {
            var enemy;
            var player
            var oBfire = false;
            var oBplayer = false;
            var oBenemy = false;
            var textScore;
            var speed = 6;
            var score = 0;
            var topScore = 0;
            this.create = function() {
                // 开启物理引擎
                game.physics.startSystem(Phaser.Physics.ARCADE);

                // 文本
                textScore = game.add.text(0, 0, 'Score:' + score + '-Best:' + topScore, {fill:'#fff', fontSize:16});

                // 游戏场景的创建
                // 创建两个球
                var width = 50;
                var height = 50;
                enemy = game.add.bitmapData(width, height);
                enemy.circle(25, 25, 25, 'gray');
                enemy = game.add.sprite(game.world.centerX - width / 2, height / 2, enemy);
                // 开启物理属性
                game.physics.arcade.enable(enemy);
                enemy.update = function() {
                    this.x += speed;
                    if (this.x + this.width >= game.width) {
                        speed = -speed;
                    }

                    if (this.x <= 0) {
                        speed = -speed;
                    }

                    if (oBenemy) {
                        this.y = game.rnd.between(height / 2, height * 4);
                        oBenemy = false;
                    }
                };

                player = game.add.bitmapData(width, height);
                player.circle(25, 25, 25 / 1.5, 'gray');
                player = game.add.sprite(game.world.centerX - width / 2, game.height - height * 2, player);
                // 开启物理属性
                game.physics.arcade.enable(player);
                // 添加鼠标按下事件
                player.inputEnabled = true;
                player.events.onInputDown.add(function() {
                    oBfire = true;
                    console.log('点击');
                }, this);
                player.update = function() {
                    // 点击小球, 将其发射出去
                    if (oBfire) {
                        this.y -= 10;
                        // 给我方小球添加判断
                        if (this.y + this.height <= 0) {
                            localStorage.setItem("topScore", Math.max(score.topScore));
                            game.state.start('game');
                            oBfire = false;
                            score = 0;
                        }
                    }

                    if (oBplayer) {
                        this.y = game.height - height * 2;
                        oBplayer = false;
                    }
                };
            }
            this.update = function() {
                // 游戏逻辑实现

                // 两球的碰撞检测
                game.physics.arcade.collide(player, enemy, function() {
                    oBfire = false;
                    oBplayer = true;
                    oBenemy = true;
                    score++;
                    textScore.setText('Score:' + score + '-Best:' + topScore);
                    speed = game.rnd.between(3, 7);
                }, null, this);
            }
        }

        // 创建游戏
        var game = new Phaser.Game(320, 480, Phaser.CANVAS);
        // 添加场景
        game.state.add('game', GameState);
        // 开始场景
        game.state.start('game');
    }
</script>
</body>
</html>